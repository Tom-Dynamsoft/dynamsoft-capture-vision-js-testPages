<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamsoft Capture Vision for the Web Step by Step</title>
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-bundle@2.2.3000/dist/dcv.bundle.js"></script>

  </head>
  <body>
    <h1>DBR v10.2.10</h1>
    <div
      id="div-ui-container"
      style="width: 70vw; height: 40vh; margin-top: 3vh"
    ></div>
    <div
      id="results"
      style="width: 100%; min-height: 10vh; font-size: 3vh; overflow: auto"
    ></div>
    <script>
      Dynamsoft.License.LicenseManager.initLicense("DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9");
        //"DLS2eyJoYW5kc2hha2VDb2RlIjoiMjE2OTk4LVRYbFhaV0pRY205cSIsIm1haW5TZXJ2ZXJVUkwiOiJodHRwczovL21sdHMuZHluYW1zb2Z0LmNvbS8iLCJvcmdhbml6YXRpb25JRCI6IjIxNjk5OCIsInN0YW5kYnlTZXJ2ZXJVUkwiOiJodHRwczovL3NsdHMuZHluYW1zb2Z0LmNvbS8iLCJjaGVja0NvZGUiOi0xNDQ1MjI5MzAyfQ=="
    
        
      Dynamsoft.Core.CoreModule.loadWasm(["DBR"]);
      const resultsContainer = document.querySelector("#results");
      (async function () {
        try {
          /**
           * Prepare the image source
           */
          const cameraViewContainer =
            document.querySelector("#div-ui-container");
          const view = await Dynamsoft.DCE.CameraView.createInstance();
          cameraEnhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance(
            view
          );
          cameraViewContainer.append(view.getUIElement());

          document
            .querySelector("default-camera-view")
            .shadowRoot.querySelector(".dce-scanlight").style =
            "display: block; position: absolute; width: 100%; height: 3px; border-radius: 50%; box-shadow: rgb(254, 142, 20) 0px 0px 2vw 1px; background: rgb(254, 142, 20); animation: 3s ease 0s infinite normal none running dce-scanlight; user-select: none;";

          router = await Dynamsoft.CVR.CaptureVisionRouter.createInstance();

          /**
           * Connect the image source
           */
          router.setInput(cameraEnhancer);
          /**
           * Define a result receiver
           */
          resultReceiver = new Dynamsoft.CVR.CapturedResultReceiver();
          resultReceiver.onCapturedResultReceived = (result) => {
            let barcodes = result.items.filter(
              (item) =>
                item.type ===
                Dynamsoft.Core.EnumCapturedResultItemType.CRIT_BARCODE
            );
            for (let item of barcodes) {
              resultsContainer.textContent = `${item.formatString}: ${item.text}`;
            }
          };
          /**
           * Register the result receiver
           */
          router.addResultReceiver(resultReceiver);
          /**
           * Start image processing
           */
          router.startCapturing("ReadSingleBarcode");
          /**
           * Activate the image source.
           */
          cameraEnhancer.open();
        } catch (ex) {
          let errMsg = ex.message || ex;
          console.error(errMsg);
          alert(errMsg);
        }
      })();
    </script>
  </body>
</html>
